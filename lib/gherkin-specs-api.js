(function () {"use strict";function Feature(a){this.description=a,this.scenarios=[]}function Scenario(a,b){this.description=a,this.steps=[],this.feature=b,this._keyword="given"}function Step(a,b,c,d){this.keyword=a,this.description=b,this.parameters=c,this.keywordText=d}function StepParser(a,b,c){this.keyWord=a,this.description=b,this.parameters=c?c:null,this.parameters&&!Array.isArray(this.parameters)&&(this.parameters=[this.parameters])}function featureStepStringify(a,b,c){return new StepParser(a,b,c).stringify()}function createRunnableStep(a,b){return{description:b,step:function(c){if(a)return a(c);throw new Error(b+"\nStep not found exception")}}}function logBeforeRun(a){var b=a.features.reduce(function(a,b){return a+b.scenarios.length},0);console.log("Found "+a.features.length+" features with "+b+" scenarios")}function FeatureRunner(){this.features=[],this.featuresImplementations=null}function FeatureSteps(a){var b=a instanceof RegExp?a:new RegExp(a.replace(/[\ \t]*[\n\r]+[\ \t]*/g,""));this.pattern=b,this.beforeSteps=[],this.afterSteps=[],this.steps=[]}function FeaturesImplementations(){this.featureStepsDefinitions=[]}!function(a){function b(){return{feature:function(a){var b=new Feature(a);return e.push(b),b},featureSteps:function(a){return d=d||new FeaturesImplementations,d.addFeature(a)},featureRunner:function(){return c=c||new FeatureRunner,c.features=e,c.featuresImplementations=d,c}}}var c,d,e=[],f=b();a=a||{};for(var g in f)f.hasOwnProperty(g)&&(a[g]=f[g])}("undefined"!=typeof window?window:module.exports),Feature.prototype.ignoreOthers=function(){return this.excludeOthers=!0,this},Feature.prototype.ignore=function(){return this.isIgnored=!0,this},Feature.prototype.scenario=function(a){var b=new Scenario(a,this);return this.excludeOthers&&b.ignoreOthers(),this.isIgnored&&b.ignore(),this.scenarios.push(b),b},Scenario.prototype.ignoreOthers=function(){return this.excludeOthers=!0,this},Scenario.prototype.ignore=function(){return this.isIgnored=!0,this},Scenario.prototype.addStep=function(a,b,c){this.steps.push(new Step(this._keyword,b,c,a))},Scenario.prototype.given=function(a,b){return this._keyword="given",this.addStep("Given",a,b),this},Scenario.prototype.when=function(a,b){return this._keyword="when",this.addStep("When",a,b),this},Scenario.prototype.then=function(a,b){return this._keyword="then",this.addStep("Then",a,b),this},Scenario.prototype.and=function(a,b){return this.addStep("And",a,b),this},Scenario.prototype.scenario=function(a){return this.feature.scenario(a)},Step.prototype.stringify=function(){return new StepParser(this.keywordText,this.description,this.parameters).stringify()},StepParser.NewLine="\n	 | ",StepParser.Separator=" | ",StepParser.prototype.getParametersNames=function(){return Object.keys(this.parameters[0])},StepParser.prototype.getParameterMaxLength=function(a){return this.parameters.map(function(b){return b[a]}).reduce(function(a,b){return b.length>a?b.length:a},a.length)},StepParser.prototype.formatParameter=function(a,b){var c=this.getParametersNames(),d=this.getParameterMaxLength(a,c),e=new Array(d).join(" ");return(e+b).slice(-1*d)+StepParser.Separator},StepParser.prototype.stringify=function(){var a=this.keyWord+" "+this.description;return this.parameters&&(a+=this.stringifyParams()),a},StepParser.prototype.stringifyParams=function(){var a=StepParser.NewLine,b=this.getParametersNames(),c=this;return b.forEach(function(b){a+=c.formatParameter(b,b)}),this.parameters.forEach(function(d){a+=StepParser.NewLine,b.forEach(function(b){a+=c.formatParameter(b,d[b])})}),a},FeatureRunner.prototype.run=function(){logBeforeRun(this);var a=this;this.features.forEach(function(b){a.runFeature(b)})},FeatureRunner.prototype.runFeature=function(a){var b=this;if(!this.featuresImplementations)throw new Error("No feature specs implemented, implements scenarios with featureSteps(...).given(...).when(...).then(...)...");var c=this.featuresImplementations.getMatchingFeatureStepsDefinition(a);describe("\nFeature: "+a.description,function(){a.scenarios.forEach(function(a){b.runScenario(a,c)})})},FeatureRunner.prototype.runScenario=function(a,b){var c=a.isIgnored;c||a.excludeOthers||(c=this.features.some(function(a){return a.scenarios.some(function(a){return a.excludeOthers})}));var d="undefined"!=typeof window?window:global,e=c?d.xdescribe:d.describe;e("\n\nScenario: "+a.description,this.runSteps(a,b))},FeatureRunner.prototype.runSteps=function(a,b){var c=this.extractExecutableSteps(a,b),d=c.reduce(function(a,b){return a+=b.description?"\n	"+b.description:""},""),e={};return function(){it(d,function(a){var b;c.forEach(function(a){if(b)b=b.then(function(){return a.step(e)});else{var c=a.step(e);c&&c.then&&(b=c)}}),b?b.then(function(){a()}):a()})}},FeatureRunner.prototype.extractExecutableSteps=function(a,b){var c=b.beforeSteps.map(function(a){return createRunnableStep(function(b){a.apply(b)},"")}),d=b.afterSteps.map(function(a){return createRunnableStep(function(b){a.apply(b)},"")}),e=a.steps.map(function(a){var c=b.getStep(a);return createRunnableStep(c,a.stringify())}),f=[].concat(c).concat(e).concat(d);return f},FeatureSteps.prototype.before=function(a){return this.beforeSteps.push(a),this},FeatureSteps.prototype.after=function(a){return this.afterSteps.push(a),this},FeatureSteps.prototype.given=function(a,b){return this.addStep("given",a,b)},FeatureSteps.prototype.when=function(a,b){return this.addStep("when",a,b)},FeatureSteps.prototype.then=function(a,b){return this.addStep("then",a,b)},FeatureSteps.prototype.addStep=function(a,b,c){var d=b instanceof RegExp?b:new RegExp("^"+b.replace(/[\ \t]*[\n\r]+[\ \t]*/g,"")+"$");return this.steps.push({pattern:d,definition:c,keyword:a}),this},FeatureSteps.prototype.getStep=function(a){var b=this.steps.map(function(b){var c=b.pattern.exec(a.description);return{definition:b.definition,pattern:b.pattern,arguments:c?c.slice(1).concat([a.parameters]):null,match:!!c&&a.keyword===b.keyword}}).filter(function(a){return a.match}),c=null;return 1===b.length&&(c=function(c){try{var d=JSON.parse(JSON.stringify(b[0].arguments));return b[0].definition.apply(c,d)}catch(e){throw new Error('error while executing "'+a.description+'"\n '+e.toString()+"\n"+e.stack)}}),c},FeaturesImplementations.prototype.addFeature=function(a){var b=new FeatureSteps(a);return this.featureStepsDefinitions.push(b),b},FeaturesImplementations.prototype.getMatchingFeatureStepsDefinition=function(a){var b=this.featureStepsDefinitions.filter(function(b){var c=a.description.replace(/[\ \t]*[\n\r]+[\ \t]*/g,"");return b.pattern.test(c)}),c=new FeatureSteps("");return c.steps=b.reduce(function(a,b){return a.concat(b.steps)},[]),c.beforeSteps=b.reduce(function(a,b){return a.concat(b.beforeSteps)},[]),c.afterSteps=b.reduce(function(a,b){return a.concat(b.afterSteps)},[]),c};})();